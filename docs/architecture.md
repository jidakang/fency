# 架构设计文档: 凿壁 (LLM 单页生成模式)

## 1. 引言
本文档基于 `docs/prd_llm_mode.md` 中定义的产品需求，并遵循 `cursor_project_rules/web-dev.mdc` 中的 LLM 生成指南，为“凿壁”项目设计系统架构。本架构的核心是支持由大语言模型 (LLM) 生成独立的、富有创意的 HTML 页面，并通过手动维护的索引页进行聚合。

## 2. 架构目标 (修订)
*   **核心目标: 最大化单页创意与独特性:** 允许每个内容页面具有独特的视觉设计和交互效果，充分发挥 LLM 的生成能力。
*   **流程简明性:** 简化从 LLM 生成到内容发布的技术步骤（无构建环节）。
*   **基本组织:** 提供一个手动维护的中心索引 (`index.html`) 来组织和链接到各个独立页面。
*   **明确的权衡:**
    *   **接受较低的可维护性:** 全局性修改（如调整通用链接、版权信息）需要手动更新多个文件。
    *   **接受较低的一致性:** 页面间的视觉风格、导航和功能可能存在显著差异。
    *   **性能可变:** 页面性能依赖于 LLM 生成的质量，可能因页面而异。

## 3. 架构模式: 独立 HTML 页面 + 手动索引
*   **描述:** 每个内容页 (`articles/*.html`) 是一个完全独立的、自包含的 HTML 文件，由 LLM 生成。这些文件包含自身的结构、内容、样式（内联、内部 `<style>` 或页面特定链接）和脚本（如有）。网站的入口 (`index.html`) 是一个手动编辑的文件，包含指向这些独立页面的链接列表，按预定分类组织。
*   **选择理由:** 该模式最直接地满足了将 LLM 创意最大化应用于每个单独页面的核心需求，避免了模板化架构对单页独特性的限制。
*   **局限性:** 如架构目标中所述，此模式牺牲了全局一致性和可维护性，索引页的更新完全依赖手动操作。

## 4. 系统架构图 (简化流程)

```mermaid
graph LR
    subgraph "内容生成 (外部)"
        A[维护者 + LLM] -- Prompt 指导 --> B(生成独立 HTML 页面<br>含 Meta/内容/样式/脚本);
    end

    subgraph "项目维护 (本地)"
        B --> C{检查 HTML<br>(对照规则)};
        C -- 保存 --> D[articles/*.html];
        E[手动编辑<br>index.html] -- 添加链接 --> F[index.html];
        D & F --> G[Git Add, Commit, Push];
    end

    subgraph "部署与访问"
        G -- 触发 GitHub Actions (或类似) --> H{静态文件托管<br>(GitHub Pages)};
        I[用户浏览器] -- 访问 --> H;
    end

    style B fill:#f9f,stroke:#333,stroke-width:2px
    style F fill:#ccf,stroke:#333,stroke-width:2px
```

**说明:**
1.  维护者指导 LLM 生成单个、完整的 HTML 文件。
2.  维护者检查文件是否符合基本规则，然后将其保存到 `articles/` 目录。
3.  维护者**手动编辑** `index.html`，添加指向新页面的链接。
4.  通过 Git 推送所有新的和修改过的 HTML 文件。
5.  静态托管平台（如 GitHub Pages）直接提供这些 HTML 文件供用户访问。**注意：部署流程中没有服务器端渲染或静态站点生成步骤。**

## 5. 核心组件/文件职责
*   `index.html`: (根目录) **手动维护**的 HTML 文件。作为网站主入口，包含按四大分类组织的链接列表，指向 `articles/` 目录下的页面。其结构和内容需手动更新。
*   `articles/`: (根目录或子目录) 存放所有由 LLM 生成的独立 `.html` 页面。每个文件都是自包含的。
*   `cursor_project_rules/web-dev.mdc`: (项目规则目录) 包含指导 LLM 生成独立 HTML 页面的详细规则和约束。
*   `deprecated_docs/`: (文档目录) 存放已废弃的旧版 PRD 和架构文档。
*   `.gitignore`: 定义 Git 应忽略的文件（如 `.bak` 文件）。
*   (可选) `assets/`: 可能用于存放极少数真正需要在多个页面手动链接的共享资源（如图标字体文件，但更推荐页面级CDN引入）。

## 6. 数据管理 (修订)
*   **无中心化数据管理:** “数据”（如内容、日期、分类）完全嵌入在每个独立的 `articles/*.html` 文件中，形式为 HTML 内容本身以及 `<head>` 中的 `<meta>` 标签。
*   **无数据处理:** 项目本身不包含读取或处理这些嵌入数据的逻辑（除了浏览器解析单个 HTML 文件）。
*   **索引数据:** `index.html` 中的链接列表、标题、摘要等信息是**手动复制和维护**的，并非从 `articles/*.html` 文件自动生成。

## 7. 技术栈 (简化)
*   **核心:** HTML5, CSS3, JavaScript (ES6+) - **具体使用方式和版本由每个独立页面决定。**
*   **版本控制:** Git。
*   **托管:** 静态文件托管服务 (如 GitHub Pages, Netlify, Vercel 等)。
*   **辅助 (页面级可选):**
    *   CSS 框架 (如 Tailwind CSS via CDN)。
    *   JavaScript 库 (如 Mermaid.js via CDN)。
    *   图标库 (如 Font Awesome via CDN)。

## 8. 部署策略
*   **方式:** 直接部署项目中的静态文件 (`index.html`, `articles/*.html`, 以及可能的 `assets/*`) 到静态托管平台。
*   **自动化 (可选但推荐):** 使用 GitHub Actions (或其他 CI/CD 工具) 配置一个简单的流程：当代码推送到 `main` 分支时，自动将仓库中的文件同步到 GitHub Pages (或其他目标平台)。**此流程不涉及构建步骤。**

## 9. 风险与缓解 (修订)
*   **核心风险:** **LLM 生成的页面不完全符合 `web-dev.mdc` 规则** (如缺少元数据、返回链接、格式错误)。
    *   **缓解:** **严格的 Prompt 工程；生成后的手动检查是必要步骤；接受一定程度的不完美。**
*   **核心风险:** **手动维护 `index.html` 极易出错** (链接错误、分类错误、排序混乱、信息遗漏)。
    *   **缓解:** **极其仔细的手动操作；定期审查 `index.html` 的准确性；保持 `index.html` 结构尽可能简单以降低复杂性。**
*   **风险:** **用户体验不一致。**
    *   **缓解:** **接受这是为了追求单页创意而做出的选择。** 可以在 `web-dev.mdc` 中对色彩、字体等给出“建议性”而非“强制性”的指导，以期 LLM 能在创意发挥时有所参考。
*   **风险:** **全局性修改成本极高。**
    *   **缓解:** **在设计 Prompt 时尽量预见未来可能需要统一的元素（如下方版权信息），并要求 LLM 稳定生成；或者接受未来修改时需要逐一处理所有文件的成本。**
*   **风险:** 单个页面性能问题 (由 LLM 生成的复杂或低效代码导致)。
    *   **缓解:** 在 Prompt 中加入性能相关的指导 (如优化图片、避免过度复杂的 JS)；对生成结果进行抽样性能评估。

## 10. 可扩展性与未来
*   **内容扩展:** 添加新页面只需要遵循生成流程并手动更新 `index.html`。
*   **功能扩展:** 在此架构下添加全局功能（如全局搜索、统一主题切换）极其困难，不推荐。单个页面可以添加自己的特定功能。
*   **架构迁移:** 如果未来需要转向更易维护的 SSG 架构，将需要大量工作来：(1) 从每个 HTML 页面提取核心内容和元数据，转换为 Markdown+Frontmatter；(2) 重新设计和实现共享的布局和组件。
