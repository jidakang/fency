# AI 驱动的颜色对比度检查与修复工作流程 (凿壁项目)

**目标:** 利用 Cursor AI 助手的能力，系统性地检查并修复网站所有页面的颜色对比度问题，确保符合 WCAG 2.1 AA 级标准，由用户进行最终视觉验证。

**主要执行者:** Cursor AI 助手 (以下简称 "AI")

**验证与决策者:** 用户

**时间:** 由 AI 与用户的交互轮次决定。

**AI 使用工具:**

*   `list_dir`: 获取文件列表。
*   `read_file`: 读取文件内容进行分析。
*   `edit_file`: 提出代码修改建议。
*   `grep_search` / `codebase_search`: (可能) 用于查找特定样式或类。
*   AI 内置的 CSS (包括 Tailwind) 和 WCAG 对比度知识。

**用户使用工具:**

*   浏览器开发者工具 (用于视觉验证)。
*   Cursor 界面 (用于查看 AI 报告、确认问题、应用/拒绝修改)。

---

**流程步骤:**

**阶段一：准备与范围定义 (AI 执行)**

1.  **确认范围:** AI 使用 `list_dir` 确认需要检查的 HTML 页面范围 (`index.html` 及 `pages/` 下所有 `.html` 文件)。
2.  **识别样式源:** AI 通过 `read_file` 分析 `index.html` 及示例页面，确定 CSS 规则来源 (Tailwind CDN, 内联 `<style>`, :root 变量, `.light`/`.dark` 规则等)。
3.  **建立分析逻辑:** AI 准备基于代码分析的对比度计算逻辑 (识别元素、推断前景色/背景色、区分亮/暗模式、计算近似对比度、对照 WCAG AA 标准)。

**阶段二：代码分析与问题识别 (AI 执行, 迭代进行)**

4.  **文件处理:** AI 选择一个或一批 HTML 文件进行处理。
5.  **读取与分析:** AI 使用 `read_file` 读取文件内容。
6.  **对比度分析 (代码层面):**
    *   AI 解析 HTML 结构和 CSS (包括 Tailwind 类和内联样式)。
    *   对关键元素 (文本、链接、按钮、特定组件如 `.card`, `.category-btn`, `.period-label` 等) 进行分析。
    *   **分别**推断元素在**亮色模式**和**暗色模式**下的近似前景色和背景色。
    *   计算近似对比度，并与 WCAG AA 标准 (4.5:1 普通文本, 3:1 大号文本/UI组件) 进行比较。
    *   检查 `:hover`, `:focus` 状态的样式对比度。
    *   检查图标、图表等非文本元素的近似对比度 (目标 ≥ 3:1)。
    *   检查 `:focus` 状态的轮廓线 (outline) 对比度 (目标 ≥ 3:1)。
    *   *AI 局限性说明:* AI 无法完美模拟浏览器渲染，特别是对于渐变背景、复杂继承、图片背景上的文本，计算结果为近似值，可能存在误差或遗漏。
7.  **报告潜在问题:** AI 在聊天中报告当前文件分析出的**潜在**对比度问题列表，包含：
    *   文件名和大致位置/元素描述。
    *   模式 (亮/暗)。
    *   涉及的元素和状态 (如：按钮悬停)。
    *   推断的颜色值 (近似)。
    *   计算的对比度 (近似)。
    *   所需标准。

**阶段三：用户验证与决策 (用户执行)**

8.  **审阅报告:** 用户仔细审阅 AI 报告的潜在问题列表。
9.  **视觉验证:** **用户必须使用浏览器开发者工具打开对应页面和模式，对 AI 报告的每个潜在问题进行视觉验证**，确认其是否确实存在对比度不足。
10. **反馈与优先级:** 用户向 AI 反馈：
    *   确认哪些是真实需要修复的问题。
    *   (可选) 对需要修复的问题进行优先级排序。

**阶段四：提出修复方案 (AI 执行, 迭代进行)**

11. **选择问题:** AI 根据用户的反馈和优先级，选择一个确认的问题进行处理。
12. **分析与修复策略:** AI 分析代码，确定修复对比度问题的最佳策略 (调整颜色、字重、大小等)，力求保持设计风格。
13. **提出编辑建议:** AI 使用 `edit_file` 工具，提出具体的代码修改建议，并解释修改内容和原因。

**阶段五：用户应用与最终验证 (用户执行)**

14. **应用修改:** 用户审阅 AI 的修改建议，如果同意则应用更改。
15. **最终视觉验证:** **用户必须再次使用浏览器开发者工具，在亮暗两种模式下，检查修改后的元素及其交互状态 (hover, focus)，确保对比度问题已解决且视觉效果可接受。**
16. **反馈结果:** 用户告知 AI 修复是否成功且符合预期。
17. **迭代或继续:**
    *   如果修复无效或效果不佳，告知 AI，AI 返回步骤 12 重新分析并提出新方案。
    *   如果修复成功，AI 将处理下一个用户确认的问题 (返回步骤 11)。

**阶段六：完成与总结 (AI + 用户)**

18. **确认完成:** 用户确认所有反馈的真实问题均已修复并通过最终验证。
19. **(可选) 更新文档:** AI 可以根据用户要求，将流程中发现的典型问题和解决方案总结，更新到 `contrastcheck.md` 的末尾或相关项目文档中。
20. **代码提交:** 用户 (或 AI 根据指令) 使用 Git 提交所有已应用的修复。

---

**交付物:**

*   AI 分析报告（在聊天记录中）。
*   用户确认并经 AI 修复、用户最终验证后的代码库。
*   (可选) 总结性的文档更新。

**核心要点:**

*   AI 负责繁琐的代码分析和提出修改建议。
*   **用户负责关键的视觉验证和最终决策**，因为 AI 无法替代真实浏览器的渲染和视觉判断。
*   这是一个协作流程，需要 AI 和用户的紧密沟通与配合。
